
#### [React Native Tutorial – Building Your First iOS App With JavaScript (Part 1)](https://www.smashingmagazine.com/2016/04/the-beauty-of-react-native-building-your-first-ios-app-with-javascript-part-1/)

#### new 

`$ react-native init AwesomeProject`

```shell
To run your app on iOS:
   cd /path/to/project
   react-native run-ios
   - or -
   Open ios/project.xcodeproj in Xcode
   Hit the Run button
To run your app on Android:
   cd /path/to/project
   Have an Android emulator running (quickest way to get started), or a device connected
   react-native run-android
```

#### run ios

`$ react-native run-ios`

#### iOS Xcode fix sign issues

Open ios project in folder ./ios.

TARGETS > General > Identity > Bundle Identifier

TARGETS > General > Signing > Team

#### run

`$ react-native run-ios` or click run button in Xcode

`$ react-native run-android`

Use `$ adb devices` to view connected android devices.

#### Specify Simulator

Add `--simulator="xxx"`:

`$ react-native run-ios --simulator="iPhone 8 Plus"`

#### shortcuts

ios: Press Cmd+R to reload, Cmd+D or shake for dev menu

android: Double tap R on your keyboard to reload, Shake or press menu button for dev menu

#### upgrade

You should consider using the new upgrade tool based on Git. It makes upgrades easier by resolving most conflicts automatically.
To use it:
- Go back to the old version of React Native
- Run "npm install -g react-native-git-upgrade"
- Run "react-native-git-upgrade"
See https://facebook.github.io/react-native/docs/upgrading.html

#### Error: EACCES: permission denied ...

`$ sudo ...`

#### Error 0: SDK location not found

```shell
* What went wrong:
A problem occurred configuring project ':app'.
> SDK location not found. Define location with sdk.dir in the local.properties file or with an ANDROID_HOME environment variable.
```

Add a file named `local.properties` to `project/android/` folder and add following content:
```
## This file is automatically generated by Android Studio.
# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
#
# This file must *NOT* be checked into Version Control Systems,
# as it contains information specific to your local configuration.
#
# Location of the SDK. This is only used by Gradle.
# For customization when using a Version Control System, please read the
# header note.
#Fri Sep 22 16:39:17 PDT 2017
# ndk.dir=/Users/gabriel_peal/sdk/ndk-bundle
sdk.dir=/Users/tom/Library/Android/sdk
```

May the path above will depend on yours. Change it if not same to me.

#### Error: jest-haste-map: Haste module naming collision:

`$ npm install`

#### Error 1

`project/gradle.properties`
```
android.useDeprecatedNdk=true
```

#### Error 2

```shell
> Configure project :app
WARNING: The specified Android SDK Build Tools version (28.0.2) is ignored, as it is below the minimum supported version (28.0.3) for Android Gradle Plugin 3.2.1.
Android SDK Build Tools 28.0.3 will be used.
To suppress this warning, remove "buildToolsVersion '28.0.2'" from your build.gradle file, as each version of the Android Gradle Plugin now has a default version of the build tools.
Checking the license for package Android SDK Platform 28 in /Users/tom/Library/Android/sdk/licenses
Warning: License for package Android SDK Platform 28 not accepted.

FAILURE: Build failed with an exception.

* What went wrong:
A problem occurred configuring project ':app'.
> Failed to install the following Android SDK packages as some licences have not been accepted.
     platforms;android-28 Android SDK Platform 28
  To build this project, accept the SDK license agreements and install the missing components using the Android Studio SDK Manager.
  Alternatively, to transfer the license agreements from one workstation to another, see http://d.android.com/r/studio-ui/export-licenses.html
  
  Using Android SDK: /Users/tom/Library/Android/sdk
```

Use Android Studio open `project/android` to install missing things. And solve `Android SDK Build Tools version (28.0.2)` problem.

#### Error 3

[Unable to load script from assets index.android.bundle on windows
](https://stackoverflow.com/a/44476757/6279975)

#### [No bundle url present #12754](https://github.com/facebook/react-native/issues/12754)

```
yustada commented on Mar 9, 2017
My problem has been solved by adding NSAllowsLocalNetworking to Info.plist

<key>NSAppTransportSecurity</key>
	<dict>
		<key>NSAllowsArbitraryLoads</key>
		<true/>
		<key>NSAllowsArbitraryLoadsInWebContent</key>
		<true/>
		<key>NSAllowsLocalNetworking</key>
		<true/>
	</dict>
</key>
I am not sure it is because of RN0.42 or iOS issue, but it is solved in my case.
```

#### [RCTBridge required dispatch_sync to load RCTDevLoadingView. This may lead to deadlocks #16376](https://github.com/facebook/react-native/issues/16376)

I was able to workaround the warning by updating `AppDelegate.m`

```
#if RCT_DEV
#import <React/RCTDevLoadingView.h>
#endif
...
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  ...
  RCTBridge *bridge = [[RCTBridge alloc] initWithBundleURL:jsCodeLocation
                                            moduleProvider:nil
                                             launchOptions:launchOptions];
#if RCT_DEV
  [bridge moduleForClass:[RCTDevLoadingView class]];
#endif
  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge
                                                   moduleName:@"Test"
                                            initialProperties:nil];
  ...
}
```

#### Android 固定在底部的元素被键盘顶起

`AndroidManifest.xml`:
```xml
<activity
  ...
  android:windowSoftInputMode="stateAlwaysHidden|adjustPan">
  ...
</activity>
```

设置`android:windowSoftInputMode="stateAlwaysHidden|adjustPan"`就行了。

#### VirtualizedList: missing keys for items, make sure to specify a key property on each item or provide a custom keyExtractor.

[Basic FlatList code throws Warning - React Native](https://stackoverflow.com/questions/44545148/basic-flatlist-code-throws-warning-react-native)

```
<Flatlist
    //...
    keyExtractor={(item, index) => index.toString()}
/>
```


# React Navigation

#### navigate to other page:

```
this.props.navigation.navigate('ToPage')
//or with params
this.props.navigation.navigate('ToPage', {
    title:'anything'
})

//get the param inside of ToPage's render()
const { params } = this.props.navigation.state;

<Text>title:{JSON.stringify(params.title)}</Text>
```

#### Back to previous page:

```
this.props.navigation.goBack()
```

#### Some library need link after installed
For example:
After run `$ npm i --save react-native-ble-manager`, you need link by command `$ react-native link`

#### About Native Module

You need rebuild project to use your module.

`NSNumber` parameter need specify `nonnull`

#### `SectionList`item过多会导致动画卡顿


#### Do not `console.log` in `componentWillMount`

In my test, I modal a page, in the page's `componentWillMount`, I `console.log` something, when modal the page, there will be a long stop.

#### hide header bar

```js
const AppNavigator = createStackNavigator(
    {
        Home: {
            screen: Home,
            navigationOptions: {
                header: null,
            }
        }
    },
    // ...
);
```

# Uninstall library

From [how to delete installed library form react native project](https://stackoverflow.com/a/38618379/6279975):

1. If it is a library based only on javascript, than you can just run `npm uninstall --save package_name` or `npm uninstall --save-dev package_name`
2. If you've installed a library with native content that requires linking, and you've linked it with rnpm then you can do: `rnpm unlink package_name` then follow step 1
3. If you've installed a library with native content manually, then just undo all the steps you took to add the library in the first place. Then follow step 1.

Search `package_name` in project, and delete lines contain it if necessary.


# react-native-camera

add `<uses-permission android:name="android.permission.CAMERA" />` to `project/android/app/src/main/AndroidManifest.xml`

# react-navigation

Parameters: [react-navigation笔记](https://www.cnblogs.com/yz1311/p/7057421.html)


# Barcode Scanner - Android

[react-native 按键事件](https://blog.csdn.net/weixin_42865887/article/details/81366129)
[Android USB 扫码枪获取扫描内容](https://blog.csdn.net/u011811983/article/details/82285507)
[kevinejohn/react-native-keyevent](https://github.com/kevinejohn/react-native-keyevent)
[android Keycode 完全对照表](https://www.cnblogs.com/Defry/p/4207988.html)


```java
// ...
import com.facebook.react.bridge.ReactContext;
import android.support.annotation.Nullable;
import android.view.KeyEvent;
import com.facebook.react.modules.core.DeviceEventManagerModule;
import com.facebook.react.bridge.WritableMap;
import com.facebook.react.bridge.Arguments;

import java.awt.event.KeyEvent;

public class MainActivity extends ReactActivity {
    // ...
    
    private void sendEvent(ReactContext reactContext, String eventName, @Nullable WritableMap params) {
        reactContext
                .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
                .emit(eventName, params);
    }

    @Override
    public boolean dispatchKeyEvent(KeyEvent event) {
        ReactContext reactContext = getReactInstanceManager().getCurrentReactContext();
        WritableMap params = Arguments.createMap();
        params.putInt("keyCode", event.getKeyCode());
        if (event.getAction() == KeyEvent.ACTION_DOWN) {
            sendEvent(reactContext, "keydown", params);
        }else if (event.getAction() == KeyEvent.ACTION_UP) {
            sendEvent(reactContext, "keyup", params);
        }
        return super.dispatchKeyEvent(event);
    }
}
```
扫码枪是连续触发按键事件来实现的，最后以回车（`keyCode=66`）结尾。所以要自行拼接起来。

比如扫描`barcode = 234`的条码，会触发四次`keydown`，四次`keyCode`分别为：`9`, `10`, `11`, `66`。

# Android apk release and sign 签名

[打包APK](https://reactnative.cn/docs/0.43/signed-apk-android.html)
[Androidstudio 3.4打包并生成签名](https://blog.csdn.net/u013297881/article/details/92805299)

#### Task :app:bundleReleaseJsAndAssets FAILED
```
> Task :app:bundleReleaseJsAndAssets FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':app:bundleReleaseJsAndAssets'.
> Could not list contents of '/...'. Couldn't follow symbolic link.
```

['Couldn't follow symbolic link' when testing release build for Android #11212](https://github.com/facebook/react-native/issues/11212)

`./android/gradlew --stop`
[Generating Release APK Fails at bundleReleaseJsAndAssets](https://stackoverflow.com/questions/36319667/generating-release-apk-fails-at-bundlereleasejsandassets)

# @ReactMethod

[How to return a Boolean from @ReactMethod in React Native?](https://stackoverflow.com/questions/37252567/how-to-return-a-boolean-from-reactmethod-in-react-native)

# add Module
In `MainApplication.java`:
```
    @Override
    protected List<ReactPackage> getPackages() {
      return Arrays.<ReactPackage>asList(
          new MainReactPackage(),
          new CustomPackage()
      );
    }
```


# NFC

`<uses-permission android:name="android.permission.NFC" />`

# sunnylqm/react-native-storage

[What happens when maximum storage size fills up?](https://github.com/sunnylqm/react-native-storage/issues/32)

When maximum size fills up, it will loop over(the 1001th will overwrite the 1st, and the 1st is gone.

#### [ERROR] Cannot add task 'wrapper' as a task with that name already exists.

[Cannot add task 'wrapper' as a task with that name already exists](https://stackoverflow.com/questions/53709282/cannot-add-task-wrapper-as-a-task-with-that-name-already-exists)


# run without development server

```shell
$ mkdir android/app/src/main/assets
$ react-native bundle --platform android --dev false --en
try-file index.js --bundle-output android/app/src/main/assets/index.android.bundle --a
ssets-dest android/app/src/main/res
$ react-native run-android --variant=debug
```

# Change Picker Component styles

Add the following code to `/res/values/styles.xml` 

```xml
<resources>

    <style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar">
      <item name="android:spinnerItemStyle">@style/SpinnerItem</item>
      <item name="android:spinnerDropDownItemStyle">@style/SpinnerDropDownItem</item>
    </style>

    <style name="SpinnerItem" parent="Theme.AppCompat.Light.NoActionBar">
      <item name="android:fontFamily">sans-serif-light</item>
      <item name="android:textSize">18dp</item>
    </style>

    <style name="SpinnerDropDownItem" parent="Theme.AppCompat.Light.NoActionBar">
        <item name="android:textColor">#ffffff</item>
        <item name="android:textSize">18dp</item>
        <item name="android:fontFamily">sans-serif-light</item>
        <item name="android:gravity">center</item>
        <item name="android:background">@drawable/mydivider</item>
    </style>

</resources>
```

Create a file at `res/drawable/mydivider.xml` and add the following code

```xml
    <shape xmlns:android="http://schemas.android.com/apk/res/android"
        android:shape="rectangle">
        <solid android:color="#29A1C9" />
        <corners android:radius="0.5dp" />
        <stroke
            android:color="#FFFFFF"
            android:width="0.1dp" />
    </shape>
```

[How to style the standard react-native android picker?](https://stackoverflow.com/questions/38921492/how-to-style-the-standard-react-native-android-picker)

### [Can I use the same keystore file to sign two different applications?](https://stackoverflow.com/a/7685529/6279975)

### [Error: EMFILE: too many open files - React Native CLI](https://stackoverflow.com/questions/58675179/error-emfile-too-many-open-files-react-native-cli)

```
$ brew update
$ brew install watchman
```

### [Error: What went wrong: Could not determine the dependencies of task ':react-native-screens:generateDebugRFile ...](https://github.com/invertase/react-native-firebase/issues/1360#issuecomment-410404715)

Moving `google()` repository at the top of the list in file build.gradle.

### Multiple apps

Change `applicationId` in `android/app/build.gradle`

[react native之android多包共存解决方案](https://blog.csdn.net/weixin_33816300/article/details/91434700)


### Error: Invariant Violation: Module AppRegistry is not a registered callable module (calling runApplication)

[https://github.com/facebook/react-native/issues/26687](https://github.com/facebook/react-native/issues/26687#issuecomment-537504575)


### Warning: Cannot update a component from inside the function body of a different component.


### Global Tips

[react-native 配置全局loading，弹框，以及toast组件](https://blog.csdn.net/oihezz/article/details/107787792)

### error: Error: Unable to resolve module `xxx` from `ddd`: xxx could not be found within the project.

`$ yarn cache clean`

If not work:

```shell
If you are sure the module exists, try these steps:
 1. Clear watchman watches: watchman watch-del-all
 2. Delete node_modules: rm -rf node_modules and run yarn install
 3. Reset Metro's cache: yarn start --reset-cache
 4. Remove the cache: rm -rf /tmp/metro-*
```